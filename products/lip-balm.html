<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tallow Lip Balm - The Butcher's Tallow</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@300;400;600;700&family=Source+Sans+Pro:wght@300;400;500;600;700&family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="product-page">
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div class="promo-banner">
                    <div class="promo-item">
                        <i class="fas fa-leaf"></i>
                        <span><strong>ALL NATURAL & HANDMADE</strong><br>Carefully crafted in Texas, ships all over the U.S.</span>
                    </div>
                    <div class="promo-item">
                        <i class="fas fa-shipping-fast"></i>
                        <span><strong>FREE SHIPPING</strong><br>On orders over $75.</span>
                    </div>
                    <div class="promo-item">
                        <i class="fas fa-star"></i>
                        <span><strong>PREMIUM QUALITY</strong><br>Grass-fed & finished traditionally rendered.</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <nav class="navbar">
                <a href="../index.html" class="logo">
                    <img src="../assets/Logo Oval - no background - new.png?v=20250101" alt="The Butcher's Tallow" class="logo-img">
                    <span class="logo-text">The Butcher's Tallow</span>
                </a>
                
                <div class="nav-menu" id="nav-menu">
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="../index.html" class="nav-link">Home</a>
                        </li>
                        <li class="nav-item">
                            <a href="../index.html#products" class="nav-link">Shop All</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a href="#tallow-balm" class="nav-link">Tallow Balm <i class="fas fa-chevron-down"></i></a>
                            <ul class="dropdown-menu">
                                <li><a href="lip-balm.html">Lip Balm</a></li>
                                <li><a href="whipped-balm.html">Whipped Balm</a></li>
                                <li><a href="beard-balm.html">Beard Balm</a></li>
                                <li><a href="leather-conditioner.html">Leather Conditioner</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a href="#all-purpose-tallow" class="nav-link">All Purpose Tallow <i class="fas fa-chevron-down"></i></a>
                            <ul class="dropdown-menu">
                                <li><a href="all-purpose-tallow.html">All Purpose Tallow</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="../index.html#about" class="nav-link">About</a>
                        </li>
                        <li class="nav-item">
                            <a href="../index.html#contact" class="nav-link">Contact</a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-actions">
                    <button class="search-btn" id="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="cart-btn" id="cart-btn">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cart-count">0</span>
                    </button>
                    <button class="mobile-menu-btn" id="mobile-menu-btn">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Product Hero Section -->
    <section class="product-hero">
        <div class="container">
            <div class="product-hero-content">
                <div class="product-images">
                    <div class="main-image">
                        <button class="image-carousel-arrow left" id="image-arrow-left" aria-label="Previous image">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <img src="../assets/all lip balm flavors black background.jpg" alt="Tallow Lip Balm" id="main-product-image">
                        <button class="image-carousel-arrow right" id="image-arrow-right" aria-label="Next image">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <div class="image-carousel-dots" id="image-carousel-dots"></div>
                    </div>
                </div>
                
                <div class="product-info">
                    <h1>Tallow Lip Balm</h1>
                    <div class="product-rating">
                        <div class="stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <span class="rating-text">Premium Quality</span>
                    </div>
                    
                    <div class="product-price">
                        <span class="current-price" id="product-price">$8.00</span>
                        <span id="bundle-discount-price" style="display: none; margin-left: 10px;">
                            <span style="text-decoration: line-through; color: #dc3545; margin-right: 8px;">$32.00</span>
                            <span class="current-price" style="color: #654321;">$24.00</span>
                        </span>
                    </div>
                    
                    <p class="product-description">
                        Nourishing single lip balm made with grass-fed tallow and natural ingredients. Provides long-lasting moisture and protection for your lips.
                    </p>
                    
                    <div class="product-options">
                        <div class="package-type-selector" style="margin-bottom: 20px;">
                            <label for="package-type">Package Type:</label>
                            <select id="package-type" style="width: 100%; padding: 12px 16px; border: 2px solid #654321; border-radius: 8px; background: #F5E6D3; color: #2c1810; font-size: 1rem; cursor: pointer;">
                                <option value="single" data-price="8.00">Single Lip Balm - $8.00</option>
                                <option value="bundle" data-price="24.00">4-Pack Bundle - $24.00</option>
                            </select>
                        </div>
                        
                        <div id="single-option" class="package-option">
                            <div class="scent-selector">
                                <label for="scent-select">Scent:</label>
                                <select id="scent-select" style="width: 100%; padding: 12px 16px; border: 2px solid #654321; border-radius: 8px; background: #F5E6D3; color: #2c1810; font-size: 1rem; cursor: pointer;">
                                    <option value="citrus" data-price="8.00">Citrus</option>
                                    <option value="vanilla" data-price="8.00">Vanilla</option>
                                    <option value="vanilla-cinnamon" data-price="8.00">Vanilla Cinnamon</option>
                                    <option value="peppermint" data-price="8.00">Peppermint</option>
                                    <option value="unscented" data-price="8.00">Unscented</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="bundle-option" class="package-option" style="display: none;">
                            <p style="margin-bottom: 15px; color: #3c2414; font-weight: 500;">Select 4 flavors for your bundle:</p>
                            <div class="bundle-flavors" style="display: grid; grid-template-columns: 1fr; gap: 15px;">
                                <div>
                                    <label for="bundle-flavor-1">Flavor 1:</label>
                                    <select id="bundle-flavor-1" class="bundle-flavor-select" style="width: 100%; padding: 10px; border: 2px solid #654321; border-radius: 6px; background: #F5E6D3; color: #2c1810;">
                                        <option value="citrus">Citrus</option>
                                        <option value="vanilla">Vanilla</option>
                                        <option value="vanilla-cinnamon">Vanilla Cinnamon</option>
                                        <option value="peppermint">Peppermint</option>
                                        <option value="unscented">Unscented</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="bundle-flavor-2">Flavor 2:</label>
                                    <select id="bundle-flavor-2" class="bundle-flavor-select" style="width: 100%; padding: 10px; border: 2px solid #654321; border-radius: 6px; background: #F5E6D3; color: #2c1810;">
                                        <option value="citrus">Citrus</option>
                                        <option value="vanilla">Vanilla</option>
                                        <option value="vanilla-cinnamon">Vanilla Cinnamon</option>
                                        <option value="peppermint">Peppermint</option>
                                        <option value="unscented">Unscented</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="bundle-flavor-3">Flavor 3:</label>
                                    <select id="bundle-flavor-3" class="bundle-flavor-select" style="width: 100%; padding: 10px; border: 2px solid #654321; border-radius: 6px; background: #F5E6D3; color: #2c1810;">
                                        <option value="citrus">Citrus</option>
                                        <option value="vanilla">Vanilla</option>
                                        <option value="vanilla-cinnamon">Vanilla Cinnamon</option>
                                        <option value="peppermint">Peppermint</option>
                                        <option value="unscented">Unscented</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="bundle-flavor-4">Flavor 4:</label>
                                    <select id="bundle-flavor-4" class="bundle-flavor-select" style="width: 100%; padding: 10px; border: 2px solid #654321; border-radius: 6px; background: #F5E6D3; color: #2c1810;">
                                        <option value="citrus">Citrus</option>
                                        <option value="vanilla">Vanilla</option>
                                        <option value="vanilla-cinnamon">Vanilla Cinnamon</option>
                                        <option value="peppermint">Peppermint</option>
                                        <option value="unscented">Unscented</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="product-actions">
                        <button class="btn btn-primary add-to-cart-btn" id="add-to-cart">
                            <i class="fas fa-shopping-cart"></i>
                            Add to Cart
                        </button>
                    </div>
                    
                    <div class="product-features">
                        <div class="feature">
                            <i class="fas fa-leaf"></i>
                            <span>100% Grass-Fed</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-shield-alt"></i>
                            <span>Traditionally Rendered</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-flag-usa"></i>
                            <span>Made in Texas, USA</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Product Details Section -->
    <section class="product-details">
        <div class="container">
            <div class="details-tabs">
                <button class="tab-btn active" data-tab="description">Description</button>
                <button class="tab-btn" data-tab="ingredients">Ingredients</button>
                <button class="tab-btn" data-tab="usage">Usage</button>
                <button class="tab-btn" data-tab="reviews">Reviews</button>
            </div>
            
            <div class="tab-content">
                <div class="tab-panel active" id="description">
                    <h3>About This Product</h3>
                    <p>Our Tallow Lip Balm is crafted with the finest grass-fed tallow and natural ingredients. This nourishing formula provides long-lasting moisture and protection for your lips, keeping them soft and healthy all day long.</p>
                    
                    <h4>Why Choose Our Lip Balm?</h4>
                    <ul>
                        <li>Made with grass-fed tallow for superior moisturizing</li>
                        <li>Available in multiple natural scents or unscented</li>
                        <li>Single lip balm perfect for daily use</li>
                        <li>No harsh chemicals or artificial ingredients</li>
                        <li>Long-lasting formula that stays put</li>
                    </ul>
                </div>
                
                <div class="tab-panel" id="ingredients">
                    <h3>Ingredients</h3>
                    <p><strong>100% Grass Fed & Finished Suet Beef Tallow</strong></p>
                    <p><strong>Organic Jojoba Oil</strong></p>
                    <p><strong>Beeswax</strong></p>
                    <p><strong>Essential Oil Blend</strong></p>
                    <p>Our lip balm contains only the finest natural ingredients. The grass-fed tallow provides deep moisturization while the organic jojoba oil and beeswax create a smooth, protective barrier for your lips.</p>
                </div>
                
                <div class="tab-panel" id="usage">
                    <h3>How to Use</h3>
                    <ul>
                        <li>Apply liberally to lips as needed throughout the day</li>
                        <li>Use before going outdoors in cold or windy weather</li>
                        <li>Apply before bedtime for overnight moisture</li>
                        <li>Perfect for dry, chapped, or cracked lips</li>
                        <li>Safe for daily use</li>
                    </ul>
                </div>
                
                <div class="tab-panel" id="reviews">
                    <div class="reviews-header">
                        <h3>Customer Reviews</h3>
                        <button class="btn btn-primary write-review-btn" data-product-id="tallow-lip-balm" data-product-name="Tallow Lip Balm">
                            <i class="fas fa-pen"></i> Write a Review
                        </button>
                    </div>
                    <div id="reviews-container">
                        <!-- Reviews will be loaded here by JavaScript -->
                        <div class="no-reviews">
                            <i class="fas fa-comment-slash"></i>
                            <h4>No reviews yet</h4>
                            <p>Be the first to share your experience with this product!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Products -->
    <section class="related-products">
        <div class="container">
            <h2>You Might Also Like</h2>
            <div class="products-grid">
                <div class="product-card">
                    <div class="product-image">
                        <img src="../assets/Large Tallow Black Background.jpeg" alt="100% All Purpose Suet Beef Tallow">
                    </div>
                    <div class="product-info">
                        <h3>100% All Purpose Suet Beef Tallow</h3>
                        <div class="product-price">Starting at $10.00</div>
                        <a href="all-purpose-tallow.html" class="btn btn-secondary">View Product</a>
                    </div>
                </div>
                
                <div class="product-card">
                    <div class="product-image">
                        <img src="../assets/Whipped Balm Unscented  2.5 oz .jpeg" alt="Whipped Tallow Balm">
                    </div>
                    <div class="product-info">
                        <h3>Whipped Tallow Balm</h3>
                        <div class="product-price">Starting at $25.00</div>
                        <a href="whipped-balm.html" class="btn btn-secondary">View Product</a>
                    </div>
                </div>
                
                <div class="product-card">
                    <div class="product-image">
                        <img src="../assets/Beard Balm black background.jpeg" alt="Tallow Beard Balm">
                    </div>
                    <div class="product-info">
                        <h3>Tallow Beard Balm</h3>
                        <div class="product-price">$15.00</div>
                        <a href="beard-balm.html" class="btn btn-secondary">View Product</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>The Butcher's Tallow</h3>
                    <p>Premium grass-fed tallow products for skincare, candle making, and household crafts. Clean, natural, and rooted in tradition.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Shop</h4>
                    <ul>
                        <li><a href="../index.html#products">All Products</a></li>
                        <li><a href="lip-balm.html">Lip Balm</a></li>
                        <li><a href="whipped-balm.html">Whipped Balm</a></li>
                        <li><a href="beard-balm.html">Beard Balm</a></li>
                        <li><a href="leather-conditioner.html">Leather Conditioner</a></li>
                        <li><a href="all-purpose-tallow.html">All Purpose Tallow</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="../index.html#contact">Contact Us</a></li>
                        <li><a href="#shipping">Shipping Info</a></li>
                        <li><a href="#returns">Returns</a></li>
                        <li><a href="#faq">FAQ</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Connect</h4>
                    <div class="social-links">
                        <a href="https://www.facebook.com/TheButchersTallow/" class="social-link" target="_blank" rel="noopener noreferrer"><i class="fab fa-facebook"></i></a>
                        <a href="https://www.instagram.com/thebutcherstallow/" class="social-link" target="_blank" rel="noopener noreferrer"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 The Butcher's Tallow. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Shopping Cart Modal -->
    <div class="cart-modal" id="cart-modal">
        <div class="cart-content">
            <div class="cart-header">
                <h3>Shopping Cart</h3>
                <button class="close-cart" id="close-cart">&times;</button>
            </div>
            <div class="cart-items" id="cart-items">
                <!-- Cart items will be populated here -->
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <strong>Total: $<span id="cart-total">0.00</span></strong>
                </div>
                <button class="btn btn-primary shopify-checkout-btn" id="shopify-checkout">
                    Proceed to Checkout
                </button>
                <button class="btn btn-secondary" id="continue-shopping">
                    Continue Shopping
                </button>
            </div>
        </div>
    </div>

    <!-- Include main scripts -->
    <script src="../shopify-config.js"></script>
    <script src="../script.js"></script>
    
    <!-- Search Modal -->
    <div class="search-modal" id="search-modal">
        <div class="search-modal-content">
            <div class="search-header">
                <input type="text" id="search-input" placeholder="Search for products..." autocomplete="off">
                <button class="close-search" id="close-search">&times;</button>
            </div>
            <div class="search-results" id="search-results">
                <p class="search-hint">Start typing to search for products...</p>
            </div>
        </div>
    </div>

    <!-- Review Submission Modal -->
    <div class="review-modal" id="review-modal">
        <div class="review-modal-content">
            <div class="review-modal-header">
                <h3>Write a Review</h3>
                <button class="close-review-modal" id="close-review-modal">&times;</button>
            </div>
            <form class="review-form" id="review-form">
                <input type="hidden" id="review-product-id" name="product-id">
                <input type="hidden" id="review-product-name" name="product-name">
                
                <div class="form-group">
                    <label for="review-name">Your Name *</label>
                    <input type="text" id="review-name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="review-email">Email (won't be published) *</label>
                    <input type="email" id="review-email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Rating *</label>
                    <div class="star-rating" id="star-rating">
                        <i class="far fa-star" data-rating="1"></i>
                        <i class="far fa-star" data-rating="2"></i>
                        <i class="far fa-star" data-rating="3"></i>
                        <i class="far fa-star" data-rating="4"></i>
                        <i class="far fa-star" data-rating="5"></i>
                    </div>
                    <input type="hidden" id="review-rating" name="rating" required>
                </div>
                
                <div class="form-group">
                    <label for="review-title">Review Title *</label>
                    <input type="text" id="review-title" name="title" required placeholder="Sum up your experience">
                </div>
                
                <div class="form-group">
                    <label for="review-text">Your Review *</label>
                    <textarea id="review-text" name="review" rows="5" required placeholder="Tell us about your experience with this product"></textarea>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="review-verified" name="verified">
                        I am a verified purchaser
                    </label>
                </div>
                
                <button type="submit" class="btn btn-primary">Submit Review</button>
                <p class="form-note">* Required fields. Reviews are moderated before being published.</p>
            </form>
        </div>
    </div>
    
    <script>
        // Product page functionality - run immediately to set up handler before script.js
        (function() {
            // Use immediate execution or wait for DOM if needed
            const initLipBalmPage = function() {
            const packageTypeSelect = document.getElementById('package-type');
            const singleOption = document.getElementById('single-option');
            const bundleOption = document.getElementById('bundle-option');
            const productPrice = document.getElementById('product-price');
            const bundleDiscountPrice = document.getElementById('bundle-discount-price');
            const addToCartBtn = document.getElementById('add-to-cart');
            
            // Function to switch to bundle
            function switchToBundle() {
                if (packageTypeSelect) {
                    packageTypeSelect.value = 'bundle';
                    const selectedOption = packageTypeSelect.options[packageTypeSelect.selectedIndex];
                    const price = selectedOption.getAttribute('data-price');
                    
                    singleOption.style.display = 'none';
                    bundleOption.style.display = 'block';
                    bundleDiscountPrice.style.display = 'inline';
                    productPrice.style.display = 'none';
                    addToCartBtn.setAttribute('data-package-type', 'bundle');
                    updateProductImage('all');
                }
            }
            
            // Check URL parameter for bundle selection
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('bundle') === '4pack') {
                switchToBundle();
            }
            
            // Package type change handler
            if (packageTypeSelect) {
                packageTypeSelect.addEventListener('change', function() {
                    const packageType = this.value;
                    const selectedOption = this.options[this.selectedIndex];
                    const price = selectedOption.getAttribute('data-price');
                    
                    if (packageType === 'single') {
                        singleOption.style.display = 'block';
                        bundleOption.style.display = 'none';
                        bundleDiscountPrice.style.display = 'none';
                        productPrice.textContent = '$' + price;
                        productPrice.style.display = 'inline';
                        addToCartBtn.setAttribute('data-package-type', 'single');
                        // Reset image to default when switching to single
                        updateProductImage('all');
                    } else if (packageType === 'bundle') {
                        singleOption.style.display = 'none';
                        bundleOption.style.display = 'block';
                        bundleDiscountPrice.style.display = 'inline';
                        productPrice.style.display = 'none';
                        addToCartBtn.setAttribute('data-package-type', 'bundle');
                        // Reset image to default when switching to bundle
                        updateProductImage('all');
                    }
                });
            }
            
            // Flavor image mapping
            const flavorImages = {
                'citrus': '../assets/citrus lip balm blank background.jpeg',
                'vanilla': '../assets/vanilla lip balm blank background.jpeg',
                'vanilla-cinnamon': '../assets/vanilla cinnamon lip balm blank background.jpeg',
                'peppermint': '../assets/peppermint lip balm blank background.jpeg',
                'unscented': '../assets/unscented lip balm blank background.jpeg',
                'all': '../assets/all lip balm flavors black background.jpg'
            };
            
            // Function to update product image based on flavor
            function updateProductImage(flavor) {
                const mainImage = document.getElementById('main-product-image');
                if (mainImage && flavorImages[flavor]) {
                    mainImage.src = flavorImages[flavor];
                    // Update alt text based on flavor
                    if (flavor === 'all') {
                        mainImage.alt = 'Tallow Lip Balm - All Flavors';
                    } else {
                        const flavorName = flavor.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
                        mainImage.alt = 'Tallow Lip Balm - ' + flavorName;
                    }
                }
            }
            
            // Scent selector change handler to update image
            const scentSelect = document.getElementById('scent-select');
            if (scentSelect) {
                // Set initial image based on selected flavor
                const initialFlavor = scentSelect.value;
                if (packageTypeSelect && packageTypeSelect.value === 'single') {
                    updateProductImage(initialFlavor);
                }
                
                // Update image when flavor changes
                scentSelect.addEventListener('change', function() {
                    const selectedFlavor = this.value;
                    updateProductImage(selectedFlavor);
                });
            }
            
            // Image carousel functionality
            const imageArrowLeft = document.getElementById('image-arrow-left');
            const imageArrowRight = document.getElementById('image-arrow-right');
            const imageCarouselDots = document.getElementById('image-carousel-dots');
            const singleFlavorSequence = ['citrus', 'vanilla', 'vanilla-cinnamon', 'peppermint', 'unscented'];
            let currentImageIndex = 0;
            
            // Function to get current image index from current flavor
            function getCurrentImageIndex() {
                if (packageTypeSelect && packageTypeSelect.value === 'bundle') {
                    return -1; // Bundle mode - no carousel
                }
                const currentFlavor = scentSelect ? scentSelect.value : 'citrus';
                const index = singleFlavorSequence.indexOf(currentFlavor);
                return index >= 0 ? index : 0;
            }
            
            // Function to update dots
            function updateDots() {
                if (!imageCarouselDots) return;
                
                if (packageTypeSelect && packageTypeSelect.value === 'bundle') {
                    imageCarouselDots.innerHTML = '';
                    return;
                }
                
                const currentIndex = getCurrentImageIndex();
                imageCarouselDots.innerHTML = '';
                
                singleFlavorSequence.forEach((flavor, index) => {
                    const dot = document.createElement('button');
                    dot.className = 'image-carousel-dot';
                    if (index === currentIndex) {
                        dot.classList.add('active');
                    }
                    dot.setAttribute('aria-label', `Go to ${flavor} image`);
                    dot.addEventListener('click', () => {
                        updateDropdownsFromImage(index);
                    });
                    imageCarouselDots.appendChild(dot);
                });
            }
            
            // Function to update dropdowns based on image index
            function updateDropdownsFromImage(index) {
                if (packageTypeSelect && packageTypeSelect.value === 'bundle') return;
                if (index >= 0 && index < singleFlavorSequence.length && scentSelect) {
                    const flavor = singleFlavorSequence[index];
                    scentSelect.value = flavor;
                    updateProductImage(flavor);
                    updateDots();
                }
            }
            
            // Left arrow click handler
            if (imageArrowLeft) {
                imageArrowLeft.addEventListener('click', function() {
                    if (packageTypeSelect && packageTypeSelect.value === 'bundle') return;
                    currentImageIndex = getCurrentImageIndex();
                    currentImageIndex = (currentImageIndex - 1 + singleFlavorSequence.length) % singleFlavorSequence.length;
                    updateDropdownsFromImage(currentImageIndex);
                });
            }
            
            // Right arrow click handler
            if (imageArrowRight) {
                imageArrowRight.addEventListener('click', function() {
                    if (packageTypeSelect && packageTypeSelect.value === 'bundle') return;
                    currentImageIndex = getCurrentImageIndex();
                    currentImageIndex = (currentImageIndex + 1) % singleFlavorSequence.length;
                    updateDropdownsFromImage(currentImageIndex);
                });
            }
            
            // Hide/show arrows and dots based on package type
            function updateArrowVisibility() {
                if (imageArrowLeft && imageArrowRight) {
                    if (packageTypeSelect && packageTypeSelect.value === 'bundle') {
                        imageArrowLeft.style.display = 'none';
                        imageArrowRight.style.display = 'none';
                        if (imageCarouselDots) imageCarouselDots.style.display = 'none';
                    } else {
                        imageArrowLeft.style.display = 'flex';
                        imageArrowRight.style.display = 'flex';
                        if (imageCarouselDots) imageCarouselDots.style.display = 'flex';
                    }
                }
            }
            
            // Update dots when scent changes
            if (scentSelect) {
                scentSelect.addEventListener('change', updateDots);
            }
            
            // Update arrow visibility when package type changes
            if (packageTypeSelect) {
                packageTypeSelect.addEventListener('change', function() {
                    updateArrowVisibility();
                    updateDots();
                });
            }
            
            updateArrowVisibility(); // Initial visibility
            updateDots(); // Initial dots
            
            // Custom add to cart handler for this page (script.js excludes this button from global handler)
            if (addToCartBtn) {
                // Set initial data attribute
                addToCartBtn.setAttribute('data-package-type', packageTypeSelect?.value || 'single');
                
                // Use capture phase (true) to run BEFORE other handlers
                addToCartBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation(); // Stop ALL other handlers from running
                    
                    const packageType = this.getAttribute('data-package-type') || document.getElementById('package-type')?.value || 'single';
                    console.log('ðŸŽ¯ Lip Balm custom handler - Package type:', packageType);
                    
                    let variantId;
                    let productId = 'tallow-lip-balm';
                    let quantity = 1;
                    let price = 8.00;
                    let title = 'Tallow Lip Balm';
                    
                    if (packageType === 'single') {
                        const scentSelect = document.getElementById('scent-select');
                        variantId = scentSelect ? scentSelect.value : 'citrus';
                        price = 8.00;
                        title = 'Tallow Lip Balm - Single (' + variantId.charAt(0).toUpperCase() + variantId.slice(1) + ')';
                    } else if (packageType === 'bundle') {
                        const flavor1 = document.getElementById('bundle-flavor-1').value;
                        const flavor2 = document.getElementById('bundle-flavor-2').value;
                        const flavor3 = document.getElementById('bundle-flavor-3').value;
                        const flavor4 = document.getElementById('bundle-flavor-4').value;
                        
                        // Format flavor names for display
                        const formatFlavor = (f) => f.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
                        const flavorsList = [flavor1, flavor2, flavor3, flavor4].map(formatFlavor).join(', ');
                        
                        variantId = 'bundle';
                        productId = 'tallow-lip-balm-bundle';
                        price = 24.00;
                        title = 'Tallow Lip Balm 4-Pack Bundle (' + flavorsList + ')';
                        quantity = 1; // Bundle is 1 unit (contains 4 lip balms)
                    }
                    
                    // Use Shopify integration if available
                    console.log('ðŸ›’ Adding to cart:', { packageType, productId, variantId, quantity, price, title });
                    
                    // Wait for shopifyIntegration to be available (script.js loads it asynchronously)
                    const tryAddToCart = () => {
                        if (window.shopifyIntegration) {
                            window.shopifyIntegration.addToCart(productId, variantId, quantity, title);
                            // Update cart display
                            if (window.cart) {
                                window.cart.updateCartDisplay();
                            }
                            console.log('âœ… Successfully added to cart');
                        } else {
                            // Retry after a short delay
                            setTimeout(tryAddToCart, 50);
                        }
                    };
                    
                    tryAddToCart();
                }, true); // Capture phase - runs BEFORE bubble phase handlers
            }
            
            // Tab functionality
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');
            
            console.log('Tab buttons found:', tabBtns.length);
            console.log('Tab panels found:', tabPanels.length);
            
            if (tabBtns.length > 0 && tabPanels.length > 0) {
                tabBtns.forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const targetTab = this.getAttribute('data-tab');
                        console.log('Tab clicked:', targetTab);
                        
                        // Remove active class from all tabs and panels
                        tabBtns.forEach(b => b.classList.remove('active'));
                        tabPanels.forEach(p => p.classList.remove('active'));
                        
                        // Add active class to clicked tab and corresponding panel
                        this.classList.add('active');
                        const targetPanel = document.getElementById(targetTab);
                        if (targetPanel) {
                            targetPanel.classList.add('active');
                            console.log('Activated tab panel:', targetTab);
                        } else {
                            console.error('Tab panel not found:', targetTab);
                        }
                        
                        // Load reviews when reviews tab is clicked
                        if (targetTab === 'reviews' && window.reviewSystem) {
                            window.reviewSystem.displayReviews('tallow-lip-balm', 'reviews-container');
                        }
                    });
                });
            } else {
                console.error('Tab buttons or panels not found');
            }
            
            // Add search button to nav if it exists
            const navActions = document.querySelector('.nav-actions');
            if (navActions && !document.getElementById('search-btn')) {
                const searchBtn = document.createElement('button');
                searchBtn.className = 'search-btn';
                searchBtn.id = 'search-btn';
                searchBtn.innerHTML = '<i class="fas fa-search"></i>';
                navActions.insertBefore(searchBtn, navActions.firstChild);
            }
        };
        
        // Run immediately if DOM is ready, otherwise wait for DOMContentLoaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initLipBalmPage);
        } else {
            initLipBalmPage();
        }
        })();
    </script>
</body>
</html>
